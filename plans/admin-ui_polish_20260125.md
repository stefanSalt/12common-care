# admin-ui 布局增强与个人信息页（2026-01-25）

## 背景 / 问题

- 现状：后台布局会随内容收缩/撑开；缺少深色导航风格、图标、可折叠菜单；顶部仅展示用户名。
- 新需求：顶部展示头像 + 更多用户信息；新增“个人信息”页，可展示并编辑个人信息。

## 目标（最小修改）

- 布局稳定：Header/Aside 固定，Main 区域滚动，不随内容改变整体高度。
- 风格升级：深色、有质感（渐变/阴影/边框），但不引入完整主题系统。
- 菜单能力：可折叠展开 + 图标 + 权限控制（沿用 1A 策略：无权限菜单不展示）。
- 用户区：头像 + 用户名/昵称 + 角色信息；提供下拉菜单（个人信息/退出登录）。
- 个人信息页：展示并编辑（昵称/邮箱/手机号等，待确认字段范围）。

## 关键待确认（你回复后我再开始编码；请最后回复“开始执行”）

1) 头像策略：
   - A. 前端占位头像（用用户名/昵称首字母 + 颜色哈希，不落库）（推荐，零后端改动）
   - B. 后端新增 `avatarUrl` 字段（显示 URL，不含上传）
   - C. 复用文件模块上传头像（需要后端扩展用户表 + 绑定逻辑）

2) 个人信息“编辑”如何落到后端：
   - A. 复用 `PUT /api/users/{id}`（需要 `user:update` 权限；普通用户可能 403）
   - B. 新增 `PUT /api/auth/me`（仅需登录，且只能改自己的基础信息）（推荐，更符合“个人信息”语义）

3) 个人信息页路由范围：
   - A. 仅后台 `/admin/profile`（推荐，最小范围）
   - B. 同时提供前台 `/profile`（给非 admin 用户使用）

4) 菜单折叠体验：
   - A. 记住上次折叠状态（localStorage）（推荐）
   - B. 固定默认展开

已确认（2026-01-25）：
- 1C：复用文件模块上传头像（扩展用户表 + 绑定逻辑）
- 头像文件可见性：PUBLIC（匿名可访问）
- 2B：新增 `PUT /api/auth/me`（仅需登录，只能改自己的基础信息）
- 个人信息可编辑字段：nickname/email/phone
- 3B：同时提供前台 `/profile` 与后台 `/admin/profile`
- 4A：折叠状态写入 localStorage，刷新保持

## 任务清单（TDD/验证优先，原子化提交但不做 git 写操作）

- [x] 布局稳定性修复（AdminLayout）
  - [x] Header 固定高度 + 背景
  - [x] Aside 固定高度/宽度（折叠态宽度更小），Main 独立滚动
- [x] 深色风格（AdminLayout）
  - [x] Header/Aside 深色渐变 + 边框/阴影
  - [x] Menu 选中态/hover 态对比度优化
- [x] 折叠菜单 + 图标
  - [x] 引入 `@element-plus/icons-vue`
  - [x] 菜单项补齐 icon + collapse toggle
- [x] 顶部用户区增强
  - [x] Avatar + 昵称/用户名 + 角色展示
  - [x] 下拉菜单：个人信息 / 退出登录
- [x] 个人信息页（Profile）
  - [x] 展示：从 `/api/auth/me` 获取并渲染
  - [x] 编辑：调用 `PUT /api/auth/me`
  - [x] 头像：调用 `POST /api/auth/me/avatar`（复用文件模块，PUBLIC）
  - [x] 保存后：刷新 store.user，并提示成功/失败
- [x] 后端支持（Auth + DB）
  - [x] sys_user 增加 `avatar_file_id`（含测试 schema 同步）
  - [x] `PUT /api/auth/me`
  - [x] `POST /api/auth/me/avatar`
- [x] 验证闭环
  - [x] `mvn test` 通过
  - [x] `npm run build` 通过
  - [x] 手工验收：折叠/展开、路由跳转、头像显示、个人信息保存、权限菜单隐藏

## 验收标准（可观测）

- 进入任一后台页面，左侧与顶部不随内容高度变化，Main 超出时内部滚动。
- 菜单可折叠/展开，有图标；折叠状态（若选 4A）刷新仍保持。
- 顶部展示头像与用户信息，且有“个人信息”入口。
- 个人信息页能正确展示；点击保存能更新并立即反映到顶部用户区。
