# admin-ui 后台管理 UI 落地计划（2026-01-25）

## 目标

- 在不改动后端接口（除非发现缺口并经你确认）的前提下，补齐后台管理端 UI：
  - 用户 / 角色 / 权限（CRUD + 关联分配）
  - 文件（上传/列表/下载/删除）
  - 通知（列表/已读/公告发布 + WebSocket 实时接收）
- 坚持最小修改：复用现有 Vue3 + Router + Pinia + Element Plus + Axios 工程骨架。
- 可验证：`npm run build` 通过；提供手工联调 checklist。

## 约束（No Gold-Plating）

- 不做主题/皮肤/复杂组件抽象；页面以“能用、清晰”为主。
- 不做超出 API 规格的功能（例如：重置密码、修改文件可见性、权限分组/树等）。
- 权限控制以“后端 403 + 前端 v-permission 隐藏按钮”为主（路由级权限仅做最小必要）。

## 路由与布局约定

- 前台占位：`/`（已存在 FrontendLayout，占位不扩展业务）
- 后台管理：`/admin/*`
  - `/admin`（Home）
  - `/admin/users`
  - `/admin/roles`
  - `/admin/permissions`
  - `/admin/files`
  - `/admin/notifications`

## 任务清单（UI → 联调）

- [x] 路由与布局
  - [x] 扩展 `frontend/src/router/index.ts`：补齐 `/admin/*` 子路由
  - [x] 扩展 `frontend/src/layouts/AdminLayout.vue`：加入最小菜单/导航（按权限显示）
- [x] API 封装（对齐 `.kiro/specs/admin-base/api-spec.md`）
  - [x] 新增 `frontend/src/api/user.ts`
  - [x] 新增 `frontend/src/api/role.ts`
  - [x] 新增 `frontend/src/api/permission.ts`
  - [x] 新增 `frontend/src/api/file.ts`
  - [x] 新增 `frontend/src/api/notification.ts`
- [x] 用户管理页（`/admin/users`）
  - [x] 分页列表
  - [x] 创建 / 编辑 / 删除
  - [x] 分配角色（覆盖式保存）
- [x] 角色管理页（`/admin/roles`）
  - [x] 列表
  - [x] 创建 / 编辑 / 删除
  - [x] 分配权限（覆盖式保存）
- [x] 权限管理页（`/admin/permissions`）
  - [x] 列表 + 创建 / 编辑 / 删除
- [x] 文件管理页（`/admin/files`）
  - [x] 我的文件分页列表
  - [x] 上传（可选 visibility，默认 PRIVATE）
  - [x] 下载 / 删除
- [x] 通知页（`/admin/notifications`）
  - [x] 分页列表 + 标记已读
  - [x] 发布公告（按钮受 `v-permission="'notification:announce'"` 控制）
  - [x] WebSocket：连接 `/ws/notification?token=...`，接收 `init` + `notification`
- [x] 验证闭环
  - [x] `npm run build` 通过
  - [x] 手工联调 checklist：登录 → RBAC → 文件 → 通知/WS

### 手工联调 checklist（建议顺序）

1) 启动后端：按 README 配置 MySQL 环境变量后执行 `mvn spring-boot:run`（backend）。
2) 启动前端：`npm run dev`（frontend）。
3) 登录：使用 `admin/admin123` 登录，应跳转到 `/admin`。
4) 菜单：应能看到“用户/角色/权限/文件/通知”（按权限显示）。
5) 用户：新增用户 → 列表可见；给用户分配角色；删除用户。
6) 权限：新增权限 → 列表可见；编辑/删除权限。
7) 角色：新增角色 → 分配权限（多选下拉，覆盖式保存）；删除角色。
8) 文件：上传 PRIVATE → 列表可见；下载/删除成功。
9) 文件（PUBLIC）：上传 PUBLIC 后，复制下载链接 `/api/files/{id}/download`，用无痕窗口访问应可下载。
10) 通知：发布公告（需 `notification:announce` 权限）→ 所有在线用户应弹出通知；通知列表可标记已读。

## 需要你确认的问题（开始编码前必须确认）

1) 菜单可见策略：
   - A. 仅显示“当前用户有权限”的菜单（推荐）
   - B. 菜单全显示，点击后由后端 403 拦截（最省事但体验差）

2) 用户创建表单字段范围：
   - A. username/password/nickname/status（推荐）
   - B. 再加 email/phone（可选）

3) 角色/权限分配交互：
   - A. `el-select multiple` 多选下拉（推荐，开发最快）
   - B. 穿梭框（更适合大量数据，但实现稍多）

4) WebSocket 建立时机：
   - A. 仅在进入 `/admin` 后建立连接（推荐）
   - B. 登录成功即建立（即使在前台占位页）

已确认（2026-01-25）：
- 1A 2A 3A 4B
